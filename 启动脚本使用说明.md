# 易邦ERP启动脚本使用说明

## 概述

本项目提供了三个启动脚本，用于简化易邦ERP系统的部署和运行：

- `start-backend.sh` - 后端服务管理脚本
- `start-frontend.sh` - 前端服务管理脚本  
- `start-all.sh` - 完整系统管理脚本

## 快速开始

### 1. 启动完整系统（推荐）

```bash
# 启动开发环境
./start-all.sh

# 或者明确指定环境
./start-all.sh dev start
```

### 2. 分别启动前后端

```bash
# 启动后端（开发环境）
./start-backend.sh dev

# 启动前端（开发环境）
./start-frontend.sh dev
```

## 详细使用说明

### 完整系统管理 (start-all.sh)

#### 基本用法
```bash
./start-all.sh [环境] [命令]
```

#### 环境选项
- `dev` - 开发环境（默认）
- `test` - 测试环境
- `prod` - 生产环境

#### 命令选项
- `start` - 启动完整系统（默认）
- `stop` - 停止完整系统
- `restart` - 重启完整系统
- `status` - 查看系统状态
- `build` - 构建生产版本
- `logs [服务]` - 查看日志
- `clean` - 清理系统
- `help` - 显示帮助信息

#### 使用示例
```bash
# 启动开发环境
./start-all.sh dev start

# 启动生产环境
./start-all.sh prod start

# 查看系统状态
./start-all.sh dev status

# 停止系统
./start-all.sh dev stop

# 重启系统
./start-all.sh dev restart

# 构建生产版本
./start-all.sh build

# 查看后端日志
./start-all.sh logs backend

# 查看前端日志
./start-all.sh logs frontend

# 查看所有日志
./start-all.sh logs all

# 清理系统
./start-all.sh clean
```

### 后端服务管理 (start-backend.sh)

#### 基本用法
```bash
./start-backend.sh [环境|命令]
```

#### 环境选项
- `dev` - 开发环境（默认）
- `test` - 测试环境
- `prod` - 生产环境

#### 命令选项
- `stop` - 停止后端服务
- `status` - 查看服务状态
- `logs` - 查看服务日志
- `help` - 显示帮助信息

#### 使用示例
```bash
# 启动开发环境
./start-backend.sh dev

# 启动生产环境
./start-backend.sh prod

# 停止服务
./start-backend.sh stop

# 查看状态
./start-backend.sh status

# 查看日志
./start-backend.sh logs
```

### 前端服务管理 (start-frontend.sh)

#### 基本用法
```bash
./start-frontend.sh [命令]
```

#### 命令选项
- `dev` - 启动开发服务器（默认）
- `build` - 构建生产版本
- `preview` - 启动预览服务器
- `stop` - 停止开发服务器
- `stop-preview` - 停止预览服务器
- `status` - 查看应用状态
- `logs [类型]` - 查看应用日志
- `clean` - 清理构建文件
- `help` - 显示帮助信息

#### 使用示例
```bash
# 启动开发服务器
./start-frontend.sh dev

# 构建生产版本
./start-frontend.sh build

# 启动预览服务器
./start-frontend.sh preview

# 停止开发服务器
./start-frontend.sh stop

# 停止预览服务器
./start-frontend.sh stop-preview

# 查看状态
./start-frontend.sh status

# 查看开发服务器日志
./start-frontend.sh logs dev

# 查看预览服务器日志
./start-frontend.sh logs preview

# 清理构建文件
./start-frontend.sh clean
```

## 系统要求

### 后端要求
- Java 17 或更高版本
- Maven 3.6+ 或 Maven Wrapper
- MySQL 8.0+
- Redis 7.0+

### 前端要求
- Node.js 18 或更高版本
- npm 或 yarn

### 系统服务
- MySQL服务需要启动
- Redis服务需要启动

## 启动流程

### 1. 环境检查
脚本会自动检查以下环境：
- Java版本和Maven环境
- Node.js和npm环境
- 系统服务状态（MySQL、Redis）

### 2. 依赖安装
- 后端：自动构建Maven项目
- 前端：自动安装npm依赖

### 3. 服务启动
- 后端：启动Spring Boot应用
- 前端：启动Vite开发服务器

### 4. 健康检查
- 检查服务进程状态
- 检查端口监听状态
- 检查应用健康状态

## 访问地址

启动成功后，可以通过以下地址访问：

- **前端应用**: http://localhost:7101
- **后端API**: http://localhost:7102
- **健康检查**: http://localhost:7102/actuator/health
- **API文档**: http://localhost:7102/swagger-ui.html

## 日志文件

脚本运行时会生成以下日志文件：

- `backend.log` - 后端应用日志
- `frontend.log` - 前端开发服务器日志
- `preview.log` - 前端预览服务器日志

## PID文件

脚本会创建以下PID文件用于进程管理：

- `backend.pid` - 后端进程ID
- `frontend.pid` - 前端开发服务器进程ID
- `preview.pid` - 前端预览服务器进程ID

## 故障排查

### 常见问题

1. **Java版本问题**
   ```bash
   # 检查Java版本
   java -version
   
   # 需要Java 17或更高版本
   ```

2. **Node.js版本问题**
   ```bash
   # 检查Node.js版本
   node -v
   
   # 需要Node.js 18或更高版本
   ```

3. **端口占用问题**
   ```bash
   # 检查端口占用
   lsof -i :7101  # 前端端口
   lsof -i :7102  # 后端端口
   ```

4. **数据库连接问题**
   ```bash
   # 检查MySQL服务
   sudo systemctl status mysql
   
   # 启动MySQL服务
   sudo systemctl start mysql
   ```

5. **Redis连接问题**
   ```bash
   # 检查Redis服务
   sudo systemctl status redis-server
   
   # 启动Redis服务
   sudo systemctl start redis-server
   ```

### 日志查看

```bash
# 查看后端日志
tail -f backend.log

# 查看前端日志
tail -f frontend.log

# 查看系统日志
./start-all.sh logs all
```

### 服务状态检查

```bash
# 查看完整系统状态
./start-all.sh status

# 查看后端状态
./start-backend.sh status

# 查看前端状态
./start-frontend.sh status
```

## 生产环境部署

### 1. 构建生产版本
```bash
./start-all.sh build
```

### 2. 部署到服务器
```bash
# 复制构建文件到服务器
scp backend/target/yibang-erp-*.jar user@server:/opt/yibang-erp/
scp -r frontend/dist/* user@server:/var/www/yibang-erp/
```

### 3. 启动生产服务
```bash
# 在服务器上启动
./start-all.sh prod start
```

## 注意事项

1. **首次运行**：脚本会自动安装依赖，可能需要一些时间
2. **端口冲突**：确保7101和7102端口未被占用
3. **服务依赖**：确保MySQL和Redis服务已启动
4. **权限问题**：确保脚本有执行权限
5. **网络访问**：确保可以访问外部API（如DeepSeek API）

## 技术支持

如果遇到问题，请：

1. 查看日志文件
2. 检查系统状态
3. 确认环境要求
4. 参考故障排查部分

更多详细信息请参考：
- `业务交互接口整理.md` - API接口文档
- `部署配置详解.md` - 部署配置文档
