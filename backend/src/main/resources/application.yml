# Spring Boot 3.x 主配置文件
spring:
  profiles:
    active: dev
  application:
    name: yibang-erp
  # 明确配置ANSI输出，避免启动时的枚举转换错误
  output:
    ansi:
      enabled: NEVER
      console-available: false
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    hikari:
      maximum-pool-size: 20
      minimum-idle: 5
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000
  data:
    redis:
      host: localhost
      port: 6379
      database: 0
      timeout: 2000ms
      # Redis连接池配置
      lettuce:
        pool:
          max-active: 8
          max-wait: -1ms
          max-idle: 8
          min-idle: 0
          # 连接池配置
          time-between-eviction-runs: 30000ms
          min-evictable-idle-time: 60000ms
      # Redis键过期策略
      keyspace-events: E
      # Redis序列化配置
      default-type: generic
      # Redis重试配置
      retry:
        max-attempts: 3
        initial-interval: 1000ms
        multiplier: 2.0
        max-interval: 10000ms
  servlet:
    multipart:
      max-file-size: 100MB
      max-request-size: 100MB
  # RabbitMQ配置
  rabbitmq:
    host: localhost
    port: 5672
    username: guest
    password: guest
    virtual-host: /
    connection-timeout: 15000
    # 消息确认配置
    publisher-confirm-type: correlated
    publisher-returns: true
    listener:
      simple:
        acknowledge-mode: manual
        retry:
          enabled: true
          max-attempts: 3
          initial-interval: 1000
          multiplier: 2.0
          max-interval: 10000

# 通用配置
server:
  port: 7102
  # 移除context-path，让应用在根路径运行

# 日志配置
logging:
  level:
    com.yibang.erp: DEBUG
    org.springframework.data.redis: DEBUG
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"

# MyBatis Plus配置
mybatis-plus:
  configuration:
    map-underscore-to-camel-case: true
    #log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
  global-config:
    db-config:
      logic-delete-field: deleted
      logic-delete-value: 1
      logic-not-delete-value: 0

# JWT配置 - 修复密钥长度问题
jwt:
  secret: yibang-erp-super-secure-jwt-secret-key-2024-with-512-bits-minimum-security-requirement-for-hmac-sha-algorithms
  expiration: 86400000

# RabbitMQ队列配置
orders:
  queue:
    ttl: 0  # 消息TTL，0表示不过期

# 管理端点配置
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      show-details: always
  # Redis健康检查配置
  health:
    redis:
      enabled: true
      timeout: 3000ms

# AI配置
ai:
  deepseek:
    base-url: https://api.deepseek.com
    api-key: sk-3f69c84d8322422498438badd98cdac3
    default-model: deepseek-chat
    max-tokens: 4096
    temperature: 0.7
    enabled: true
    timeout: 30000
#掌上大学回调
zsd:
    callback_prod:
        url: https://zdms-admin-test.wxhand.com/bsc-erp/yibang/orderLogistics/callBack
        token: your-callback-token
    callback_test:
        url: https://api-callback.zsdx.cn/bsc-erp/yibang/orderLogistics/callBack
        token: your-callback-token